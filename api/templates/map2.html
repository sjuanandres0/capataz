{% extends "layout.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}

<style>
    #map { height: 800px; }
</style>

<div class="container">
    <h1>Map with Leaflet</h1>
    <div id="map"></div>
</div>

<script>
        var map = L.map('map').setView([-32.84478543873638, -61.11837708005918], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
            draw: {
                polygon: true,
                polyline: false,
                rectangle: false,
                circle: false,
                marker: false
            },
            edit: {
                featureGroup: drawnItems
            }
        });
        map.addControl(drawControl);

        map.on(L.Draw.Event.CREATED, function(event) {
            var layer = event.layer;
            drawnItems.addLayer(layer);
            
            // Get coordinates of the polygon
            var coordinates = layer.getLatLngs()[0].map(function(latlng) {
                return [latlng.lat, latlng.lng];
            });

            // Send coordinates to Flask endpoint
            var formData = new FormData();
            formData.append('coordinates', JSON.stringify(coordinates));

            fetch('/get_polygon_coordinates', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        });
    </script>

{% endblock %}