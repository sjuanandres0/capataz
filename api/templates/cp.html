{% extends "layout.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}

<style>
    .nav-pills .nav-item .nav-link {
        background-color: var(--bs-light);
        color: var(--bs-success);
    }
    .nav-pills .nav-item .nav-link.active {
        background-color: var(--bs-success);
        color: var(--bs-light);
    }
    .list-group-item.active {
        background-color: var(--bs-success);
        border-color: var(--bs-success);
    }
</style>

<div class="container mb-3">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item"><a
                    href="/agricultura">Agricultura</a></li>
            <li class="breadcrumb-item active" aria-current="page">CP</li>
        </ol>
    </nav>
</div>

<hr>

<div class="container mx-auto">
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <button class="btn btn-outline-warning btn-sm" type="button"
            data-bs-toggle="modal" data-bs-target="#newCpModal">Nueva
            CP</button>
    </div>
</div>

<hr>

<!-- Status Pills Navigation -->
<div class="container mx-auto">
    <ul class="nav nav-pills nav-fill mb-3" id="pills-tab-status"
        role="tablist">
        {% for status, items in params.grouped_cp.items() %}
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if loop.index == 1 %}active{% endif %}"
                id="{{ status }}-tab"
                data-bs-toggle="pill" data-bs-target="#{{ status }}"
                type="button" role="tab" aria-controls="{{ status }}"
                aria-selected="{% if loop.index == 1 %}true{% else %}false{% endif %}">
                {{ status }} <span class="badge bg-secondary">{{items|length}}</span>
            </button>
        </li>
        {% endfor %}
    </ul>
</div>

<hr>

<!-- Status Pills Content -->
<div class="tab-content" id="pills-tab-status-content">
    {% for status, items in params.grouped_cp.items() %}
    <div class="tab-pane fade"
        id="{{ status }}" role="tabpanel"
        aria-labelledby="{{ status }}-tab" tabindex="0">
        <div class="container">

            <ul class="nav flex-column nav-pills nav-fill mb-3"
                id="pills-tab-cp"
                role="tablist">
                {% for i in items %}
                <li class="nav-item" role="presentation">
                    <button
                        class="nav-link"
                        id="{{ i.id }}-tab"
                        name="{{ status }}-cp"
                        data-bs-toggle="pill" data-bs-target="#{{ i.id }}"
                        type="button" role="tab" aria-controls="{{ i.id }}"
                        aria-selected="false">
                        {{loop.index}} - {{i.id}} - {{i.ctg}}
                    </button>
                </li>
                {% endfor %}
            </ul>

        </div>
    </div>
    {% endfor %}
</div>

<hr>

<!-- CP Pills Content -->
<div class="tab-content" id="pills-tab-cp-content">
    {% for status, items in params.grouped_cp.items() %}
    {% for i in items %}
    <div class="tab-pane fade"
        id="{{ i.id }}" role="tabpanel"
        name="{{ status }}-cp"
        aria-labelledby="{{ i.id }}-tab" tabindex="0">
        <div class="container">
            <ul class="list-group">
                <li class="list-group-item active" aria-current="true">Numero CP: {{i.id}}</li>
                <li class="list-group-item">CTG: {{i.ctg}}</li>
                <li class="list-group-item">Transportista: {{i.transport}}</li>
                <li class="list-group-item">Origen: {{i.origin}}</li>
                <li class="list-group-item">Destino: {{i.destination}}</li>
                <li class="list-group-item">KM: {{i.km}}</li>
                <li class="list-group-item">KG: {{i.kg}}</li>
                <li class="list-group-item">Especie: {{i.type}}</li>
                <li class="list-group-item">Fecha: {{i.date}}</li>
            </ul>
        </div>
    </div>
    {% endfor %}
    {% endfor %}
</div>

<hr>

<!-- Modal -->
<div class="modal fade" id="newCpModal" tabindex="-1"
    aria-labelledby="newCpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="newCpModalLabel">Nueva Carta de
                    Porte</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Clsose"></button>
            </div>
            <form method="POST">
                <div class="modal-body">
                    <div class="form-floating mb-1">
                        <input type="number" class="form-control" name="id"
                            placeholder="55123456" min=1 required>
                        <label for="floatingInput">Numero</label>
                    </div>
                    <div class="form-floating mb-1">
                        <input type="number" class="form-control" name="ctg"
                            placeholder="1234890" min=1 required>
                        <label for="floatingInput">Codigo de Trazabilidad de
                            Granos (CTG)</label>
                    </div>
                    <div class="form-floating mb-1">
                        <select class="form-select" name="tranport"
                            aria-label="Floating label select example" required>
                            <option value>Seleccione transportista</option>
                            {% for t in params.transportista %}
                            <option value="{{t.number}}">{{t.name}}
                                ({{t.number}})</option>
                            {% endfor %}
                        </select>
                        <label for="floatingSelect">Transportista</label>
                    </div>
                    <div class="form-floating mb-1">
                        <select class="form-select" name="type"
                            aria-label="Floating label select example" required>
                            <option value>Seleccione especie</option>
                            {% for e in params.especie %}
                            <option value="{{e.name}}">{{e.name}}</option>
                            {% endfor %}
                        </select>
                        <label for="floatingSelect">Especie</label>
                    </div>
                    <div class="form-floating mb-1">
                        <select class="form-select" name="origin"
                            aria-label="Floating label select example" required>
                            <option value>Seleccione origen</option>
                            <option value="Lucio V Lopez">Lucio V Lopez</option>
                            <option value="Los Pinos">Los Pinos</option>
                            <option value="El Escondido">El Escondido</option>
                        </select>
                        <label for="floatingSelect">Origen</label>
                    </div>
                    <div class="form-floating mb-1">
                        <select class="form-select" name="destination"
                            aria-label="Floating label select example" required>
                            <option value>Seleccione destino</option>
                            <option value="Bunge">Bunge</option>
                            <option value="Cargill">Cargill</option>
                            <option value="Alfagro">Alfagro</option>
                        </select>
                        <label for="floatingSelect">Destino</label>
                    </div>
                    <div class="form-floating mb-1">
                        <input type="number" class="form-control" name="km"
                            placeholder="250" min=1 max=5000 required>
                        <label for="floatingInput">Kilometros</label>
                    </div>
                    <div class="form-floating mb-1">
                        <input type="number" class="form-control" name="kg"
                            placeholder="29500" min=1 max=40000 required>
                        <label for="floatingInput">Kilogramos</label>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit"
                        class="btn btn-success">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    const params = {{ params| tojson }}
    console.log(params)
    

    Object.keys(params.grouped_cp).forEach(status => {
        console.log('status: ', status)
        document.getElementById(`${status}-tab`).addEventListener('hide.bs.tab', () => {
            const elements = document.getElementsByName(`${status}-cp`)
            elements.forEach(e => {
                e.classList.remove('active')
                e.ariaSelected = 'false'
            })
        })
    
    })

</script>

{% endblock %}
